Continue with authors_plan.txt - start at Phase 1

PROSELENOS: AUTHORS MODE MIGRATION TO SUPABASE
==============================================

STATUS: SQL COMPLETE, CODE MIGRATION NEXT
-----------------------------------------

COMPLETED:
[x] Schema SQL run in Supabase SQL Editor
[x] Tables created: author_config, projects, book_metadata, default_tool_prompts, tool_prompts
[x] Bucket created: author-files (private)
[x] tool_prompts.sql run - 33 default prompts seeded
[x] supabase-setup.sql updated locally


GOAL
----
Replace {userId}_proselenos GitHub repo with Supabase tables + storage.
NO automatic syncing - user is in control.


CURRENT GITHUB STRUCTURE (to be replaced):
------------------------------------------
{userId}_proselenos/
├── proselenos-config.json      → author_config table
├── proselenos-settings.json    → author_config table (api_keys jsonb)
├── tool-prompts/               → tool_prompts table
│   └── {category}/{tool}.txt
└── {ProjectName}/              → projects table + author-files bucket
    ├── book-metadata.json      → book_metadata table
    ├── manuscript.txt          → author-files bucket
    ├── manuscript.epub         → author-files bucket
    ├── manuscript.pdf          → author-files bucket
    └── manuscript.html         → author-files bucket


SUPABASE STORAGE STRUCTURE:
---------------------------
author-files/
└── {google_id}/
    └── {project_name}/
        ├── manuscript.txt
        ├── manuscript.epub
        ├── manuscript.pdf
        ├── manuscript.html
        └── {uploaded_files}.*


IMPLEMENTATION PHASES
=====================

PHASE 1: Remove useBooksSync (quick win - stops console noise)
--------------------------------------------------------------
Files to modify:
  - apps/proselenos-app/src/app/library/hooks/useBooksSync.ts  → DELETE
  - apps/proselenos-app/src/app/library/page.tsx               → Remove useBooksSync import/usage
  - apps/proselenos-app/src/hooks/useSync.ts                   → DELETE if unused


PHASE 2: Config/Settings Actions
--------------------------------
NEW FILE: apps/proselenos-app/src/lib/supabase-config-actions.ts

Functions to implement:
  - getAuthorConfig(userId)           → query author_config table
  - saveAuthorConfig(userId, config)  → upsert author_config
  - updateCurrentProject(userId, projectName) → update author_config
  - updateAIModel(userId, model)      → update author_config
  - updateDarkMode(userId, dark)      → update author_config

Then modify:
  - apps/proselenos-app/src/lib/github-config-actions.ts → Call Supabase instead


PHASE 3: Project CRUD Actions
-----------------------------
NEW FILE: apps/proselenos-app/src/lib/supabase-project-actions.ts

Functions to implement:
  - listProjects(userId)              → query projects table
  - createProject(userId, name)       → insert projects
  - deleteProject(userId, projectId)  → delete from projects + storage
  - selectProject(userId, projectId)  → update author_config.current_project

Then modify:
  - apps/proselenos-app/src/lib/github-project-actions.ts → Call Supabase instead


PHASE 4: File Operations
------------------------
ADD TO: apps/proselenos-app/src/lib/supabase-project-actions.ts

Functions to implement:
  - listProjectFiles(userId, projectName)           → list from author-files bucket
  - uploadFileToProject(userId, projectName, file)  → upload to bucket
  - downloadFile(userId, projectName, fileName)     → download from bucket
  - deleteFile(userId, projectName, fileName)       → delete from bucket
  - readTextFile(userId, projectName, fileName)     → download + decode UTF-8


PHASE 5: Book Metadata
----------------------
ADD TO: apps/proselenos-app/src/lib/supabase-project-actions.ts
  OR
NEW FILE: apps/proselenos-app/src/lib/supabase-metadata-actions.ts

Functions to implement:
  - loadBookMetadata(projectId)              → query book_metadata
  - saveBookMetadata(projectId, metadata)    → upsert book_metadata


PHASE 6: Tool Prompts
---------------------
NEW FILE: apps/proselenos-app/src/lib/supabase-tool-actions.ts

Functions to implement:
  - getToolPrompt(userId, category, toolName)              → query tool_prompts
  - updateToolPrompt(userId, category, toolName, content)  → upsert tool_prompts
  - listToolCategories(userId)                             → distinct categories
  - seedUserToolPrompts(userId)                            → copy from default_tool_prompts

Then modify:
  - apps/proselenos-app/src/lib/tools-actions.ts → Call Supabase instead


PHASE 7: Publishing Actions
---------------------------
Modify: apps/proselenos-app/src/lib/publish-actions.ts

Functions to update (read from Supabase, write to Supabase):
  - generateHTMLOnlyAction
  - generateEPUBOnlyAction
  - generatePDFOnlyAction
  - generateEPUBForLocalImportAction
  - publishManuscriptAction


PHASE 8: Auth Integration
-------------------------
Modify: apps/proselenos-app/src/app/api/auth/[...nextauth]/route.ts
  - Remove GitHub repo creation
  - Keep Supabase user upsert (already done)
  - Add: seed tool_prompts for new users

DELETE: apps/proselenos-app/src/lib/github-repo-actions.ts


PHASE 9: Cleanup - Remove Deprecated GitHub Code
------------------------------------------------
Files to DELETE:
  - apps/proselenos-app/src/lib/github-storage/repo-manager.ts
  - apps/proselenos-app/src/lib/github-storage/file-upload.ts
  - apps/proselenos-app/src/lib/github-storage/file-download.ts
  - apps/proselenos-app/src/lib/github-storage/file-delete.ts
  - apps/proselenos-app/src/lib/github-config-storage.ts
  - apps/proselenos-app/src/lib/github-tool-actions.ts
  - apps/proselenos-app/src/lib/github-repo-actions.ts
  - packages/master-tracker/ (entire package)


FILES SUMMARY
=============

NEW FILES TO CREATE:
  - apps/proselenos-app/src/lib/supabase-config-actions.ts
  - apps/proselenos-app/src/lib/supabase-project-actions.ts
  - apps/proselenos-app/src/lib/supabase-tool-actions.ts

FILES TO MODIFY:
  - apps/proselenos-app/src/lib/github-config-actions.ts
  - apps/proselenos-app/src/lib/github-project-actions.ts
  - apps/proselenos-app/src/lib/tools-actions.ts
  - apps/proselenos-app/src/lib/publish-actions.ts
  - apps/proselenos-app/src/lib/docx-conversion-actions.ts
  - apps/proselenos-app/src/lib/epub-conversion-actions.ts
  - apps/proselenos-app/src/app/api/auth/[...nextauth]/route.ts
  - apps/proselenos-app/src/components/ClientBoot.tsx
  - apps/proselenos-app/src/lib/github/fastInitServer.ts
  - apps/proselenos-app/src/app/library/page.tsx

FILES TO DELETE:
  - apps/proselenos-app/src/lib/github-storage/repo-manager.ts
  - apps/proselenos-app/src/lib/github-storage/file-upload.ts
  - apps/proselenos-app/src/lib/github-storage/file-download.ts
  - apps/proselenos-app/src/lib/github-storage/file-delete.ts
  - apps/proselenos-app/src/lib/github-config-storage.ts
  - apps/proselenos-app/src/lib/github-tool-actions.ts
  - apps/proselenos-app/src/lib/github-repo-actions.ts
  - apps/proselenos-app/src/app/library/hooks/useBooksSync.ts
  - apps/proselenos-app/src/hooks/useSync.ts
  - packages/master-tracker/ (entire package)


TESTING AFTER EACH PHASE
========================
1. npx tsc --noEmit        (Claude runs this)
2. pnpm build + pnpm start (User runs this)


NOTES
=====
- All Supabase calls via Server Actions only
- Service role key bypasses RLS
- Files stored by google_id (same pattern as Reader migration)
- NO automatic syncing
- User-initiated actions only
