ONE-BY-ONE EDITING FEATURE
==========================

OVERVIEW
--------
Two-panel editor that walks user through AI-suggested edits one at a time.
Works with ANY AI tool report that follows the standard format.
User decides: Accept / Skip / Custom for each issue.
App applies changes automatically.

Completely separate from existing View-Edit code.


TWO-PANEL LAYOUT
----------------

+---------------------------------------------------------------------+
|                            [ Save ]  [ Close ]                      |
+----------------------------------+----------------------------------+
|         LEFT PANEL               |         RIGHT PANEL              |
|         (Manuscript)             |         (Current Issue)          |
+----------------------------------+----------------------------------+
|                                  |                                  |
|  Full manuscript text with       |  (a) ORIGINAL                    |
|  current passage HIGHLIGHTED     |      She walked slowly across    |
|                                  |      the dusty floor             |
|  The door creaked open. [She     |                                  |
|  walked slowly across the dusty  |  (b) ISSUES                      |
|  floor], her footsteps echoing   |      Weak verb + adverb combo    |
|  in the empty hall.              |                                  |
|                                  |  (c) SUGGESTED                   |
|                                  |      She crept across the        |
|                                  |      dusty floor                 |
|                                  |                                  |
|                                  |  (d) EXPLANATION                 |
|                                  |      Stronger verb eliminates    |
|                                  |      need for adverb             |
|                                  |                                  |
+----------------------------------+----------------------------------+
|  Progress: 3 of 47               |  [ Accept ] [ Skip ] [ Custom ]  |
+---------------------------------------------------------------------+

Right panel shows (matches report format):
  (a) ORIGINAL - verbatim passage (no extra quotes added)
  (b) ISSUES - what's wrong
  (c) SUGGESTED - the replacement
  (d) EXPLANATION - why it helps

Left panel:
  - Shows full manuscript
  - Current passage is highlighted
  - Scrolls to keep highlighted passage visible


CORE BEHAVIOR
-------------
- Accept: Replace passage in manuscript, move to next issue
- Skip: Leave unchanged, move to next issue
- Custom: User edits the fix, then apply it
- Save: User clicks to save manuscript to Supabase (user controls when)
- Close: Cleanup IndexedDB session, exit modal


SEPARATION FROM VIEW-EDIT
-------------------------
DO NOT TOUCH:
- DualPanelEditor.tsx
- useToolsManager.ts
- Existing tool execution flow

ONLY TOUCH:
- AIToolsSection.tsx (add one button + modal render)

NEW STANDALONE FILES (generic names, not tool-specific):
- src/types/oneByOne.ts
- src/utils/parseToolReport.ts
- src/utils/safeReplace.ts
- src/services/oneByOne/oneByOneCache.ts
- src/app/one-by-one/useOneByOneSession.ts
- src/app/one-by-one/OneByOneModal.tsx


SAFE REPLACE FUNCTION
---------------------
Before replacing, count how many times passage appears:
- Zero matches: Error "not found" - user can Skip or Custom
- One match: Safe to replace
- Multiple matches: Error "not unique" - user can Skip or Custom


INDEXEDDB SESSION
-----------------
Database: ProselenosOneByOne (separate from e-reader)
Store: sessions

Stores:
- originalContent (untouched backup)
- workingContent (modified as user accepts)
- issues[] array parsed from report
- currentIndex
- stats (accepted, skipped, custom counts)

Close always cleans up IndexedDB - fresh start next time.


PARSING TOOL REPORT FORMAT
--------------------------
Works with ANY AI tool report that follows this format.
No new AI prompt needed.

Report structure (sections separated by ---):

ORIGINAL TEXT:
[verbatim passage]

ISSUES IDENTIFIED:
- [what's wrong]

SUGGESTED CHANGES:
[the fix]

EXPLANATION:
[why it helps]

---

Parser logic:
1. Split report by "---"
2. For each section:
   - Skip if contains "No edits suggested"
   - Extract text between ORIGINAL TEXT: and ISSUES IDENTIFIED:
   - Extract text between ISSUES IDENTIFIED: and SUGGESTED CHANGES:
   - Extract text between SUGGESTED CHANGES: and EXPLANATION:
   - Extract text after EXPLANATION:
3. Return array of issues

Benefits:
- Works with line_editing, copy_editing, or any tool using this format
- User runs any tool, chooses View-Edit OR One-by-one
- No new AI prompt needed
- Future: can update tool prompts to improve format compatibility


TYPE NAMES (generic)
--------------------
- ReportIssue (not LineEditIssue)
- ReportIssueWithStatus
- IssueStatus
- OneByOneSession (not LineEditSession)
- OneByOneStats
- SafeReplaceResult


IMPLEMENTATION ORDER
--------------------
1. Types (src/types/oneByOne.ts)
2. Report parser utility (src/utils/parseToolReport.ts)
3. safeReplace utility (src/utils/safeReplace.ts)
4. IndexedDB cache (src/services/oneByOne/oneByOneCache.ts)
5. React hook (src/app/one-by-one/useOneByOneSession.ts)
6. Two-panel modal (src/app/one-by-one/OneByOneModal.tsx)
7. Add button to AIToolsSection.tsx
8. TypeScript checks


FUTURE
------
- Some AI reports may not fit the format perfectly - deal with later
- Can update tool prompts to improve format compatibility
- Could add JSON option for specific tools if needed
